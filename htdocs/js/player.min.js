ToyundaPlayer=(function(){var h,q,l,p,k,e,r,a,d,g,n,m,j,o,i,f,c;function b(s){if(typeof s==="undefined"){s=new object()}if(typeof s.element==="object"){if(s.element.nodeName==="VIDEO"){h=s.element}else{if(s.element.nodeName==="TOYUNDA-PLAYER"){q=s.element;h=document.createElement("video");q.appendChild(h)}else{console.log("Element not known: "+s.element.nodeName)}}}else{if(typeof s.id==="string"){h=document.getElementById(s.id)}}d=this;h.preload="metadata";h.poster="img/logo_sans_titre.png";if(typeof q==="undefined"){q=document.createElement("div");q.className="ToyundaPlayer";h.parentNode.insertBefore(q,h);q.appendChild(h)}else{if(q.className.search(/ToyundaPlayer/i)<0){q.className=q.className+" ToyundaPlayer"}}l=document.createElement("div");l.className="subtitles";h.parentNode.insertBefore(l,h);p=document.createElement("div");p.className="controls btn-group";q.insertBefore(p,h);c();h.addEventListener("play",function(){e=h.videoWidth/2*2;r=h.videoHeight/2*2;m()},false);h.addEventListener("loadedmetadata",function(){f()},false);h.addEventListener("click",function(){d.togglePlay()},false);var t=null;h.addEventListener("mousemove",function(){if(t!==null){clearTimeout(t)}p.style.display="block";h.style.cursor="";t=setTimeout(function(){p.style.display="none";h.style.cursor="none"},5000)},false);document.addEventListener("mozfullscreenchange",function(){f()},false);document.addEventListener("fullscreenchange",function(){f()},false);document.addEventListener("webkitfullscreenchange",function(){f()},false);document.addEventListener("msfullscreenchange",function(){f()},false);h.addEventListener("dblclick",function(){d.toggleFullScreen()},false);f();if(typeof s.src!=="undefined"){d.setVideo(s.src)}}b.prototype.volumeUp=function(){if(h.volume+0.1<=1){h.volume=h.volume+0.1}};b.prototype.volumeDown=function(){if(h.volume-0.1>=0){h.volume=h.volume-0.1}};b.prototype.seekForward=function(){if(h.currentTime+5<h.duration){h.currentTime=h.currentTime+5}};b.prototype.seekBackward=function(){if(h.currentTime-5>0){h.currentTime=h.currentTime-5}else{h.currentTime=0}};b.prototype.fullScreen=function(){var s=h.parentNode;if(s.requestFullscreen){s.requestFullscreen()}else{if(s.msRequestFullscreen){s.msRequestFullscreen()}else{if(s.mozRequestFullScreen){s.mozRequestFullScreen()}else{if(s.webkitRequestFullscreen){s.webkitRequestFullscreen()}}}}g=h.style.width;n=h.style.height;h.style.width="100%";h.style.height="100%"};b.prototype.cancelFullScreen=function(){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}h.style.width=g;l.style.width=g;h.style.height=n};b.prototype.toggleFullScreen=function(){var s=false;if(typeof document.fullScreen!=="undefined"){s=document.fullScreen}else{if(typeof document.msFullScreen!=="undefined"){s=document.msFullScreen}else{if(typeof document.mozFullScreen!=="undefined"){s=document.mozFullScreen}else{if(typeof document.webkitFullScreen!=="undefined"){s=document.webkitFullScreen}}}}if(s){d.cancelFullScreen()}else{d.fullScreen()}};b.prototype.togglePlay=function(){if(h.paused){h.play()}else{h.pause()}};b.prototype.setVideo=function(s){var t=new XMLHttpRequest();h.setAttribute("src",s+".ogg");j();t.open("GET",s+".txt",true);t.onreadystatechange=function(u){if(u.target.readyState===4){a=[];if(u.target.status===200){i(u.target.responseText)}else{console.log("Lyrics désactivé")}}};t.send()};f=function(){l.style.width=Math.floor(h.offsetWidth)+"px";p.style.width=l.style.width;k=Math.floor(h.offsetWidth/40);l.style.fontSize=k+"px";j()};j=function(){while(l.hasChildNodes()){l.removeChild(l.firstChild)}};m=function(){if(h.paused||h.ended){return}o();setTimeout(function(){m()},10)};i=function(v){v=v.replace(/\r/g,"");var u=v.split("\n");for(var t in u){var s=u[t];var w=s.match(/\{([0-9]*)\}\{([0-9]*)\}(.*)/);if(w==null){console.info("Line "+t+" not reconnized : "+s)}else{a.push({from:w[1],to:w[2],text:w[3]})}}};o=function(){var D=Math.floor(h.currentTime.toFixed(5)*30);j();for(var I in a){var C=a[I];if((C.from<=D)&&(C.to>D)){var E=C.text.replace(/\{.*\}/g,"");var H=document.createElement("div");H.style.marginTop=k+"px";H.innerHTML=E.replace(/\|/g,"<br/>").replace(/ /g,"&nbsp;").replace(/ÿ/g,'<img src="img/logo_sans_titre.png" width="'+k+'px"/>');var s=C.text.match(/\{s:([0-9]*)\}/);if(s!=null){H.style.fontSize=(k*s[1]/30)+"px"}var w=C.text.match(/\{o:([0-9]*),([0-9]*)\}/);if(w!=null){H.style.marginTop=(w[2]*h.offsetHeight/600)+"px";H.style.marginLeft=(w[1]*h.offsetWidth/800)+"px";H.style.width="auto"}var G=C.text.match(/\{c:\$([0-9A-F]{2})?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})(:\$([0-9A-F]{2})?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2}))?\}/);if(G!=null){H.style.color="#"+G[4]+G[3]+G[2];if(typeof G[1]!="undefined"&&G[1]!=null){if(typeof G[6]!="undefined"&&G[6]!=null){var y=parseInt(G[1],16);var u=parseInt(G[6],16);H.style.opacity=(y+((u-y)*(D-C.from)/(C.to-C.from)))/256}else{H.style.opacity=parseInt(G[1],16)/256}}if(typeof G[7]!="undefined"&&G[7]!=null){var A=parseInt(G[4],16);var v=parseInt(G[9],16);var x=parseInt(G[3],16);var t=parseInt(G[8],16);var B=parseInt(G[2],16);var z=parseInt(G[7],16);var K=(D-C.from)/(C.to-C.from);var F=Math.floor(A+((v-A)*K));var J=Math.floor(x+((t-x)*K));var L=Math.floor(B+((z-B)*K));H.style.color="rgb("+F+", "+J+", "+L+")"}}l.appendChild(H)}}};c=function(){var w,x,t,v,s,u;w=document.createElement("button");w.className="btn btn-primary";w.innerHTML='<i class="glyphicon glyphicon-play"></i><i class="glyphicon glyphicon-pause"></i>';w.addEventListener("click",d.togglePlay);p.appendChild(w);x=document.createElement("button");x.className="btn btn-default";x.innerHTML='<i class="glyphicon glyphicon-backward"></i>';x.addEventListener("click",d.seekBackward);p.appendChild(x);t=document.createElement("button");t.innerHTML='<i class="glyphicon glyphicon-forward"></i>';t.className="btn btn-default";t.addEventListener("click",d.seekForward);p.appendChild(t);s=document.createElement("button");s.className="btn btn-default";s.innerHTML='<i class="glyphicon glyphicon-volume-down"></i>';s.addEventListener("click",d.volumeDown);p.appendChild(s);v=document.createElement("button");v.innerHTML='<i class="glyphicon glyphicon-volume-up"></i>';v.className="btn btn-default";v.addEventListener("click",d.volumeUp);p.appendChild(v);u=document.createElement("button");u.className="btn btn-default";u.innerHTML='<i class="glyphicon glyphicon-resize-full"></i>';u.addEventListener("click",d.toggleFullScreen);p.appendChild(u)};return b})();window.addEventListener("load",function(){var d=document.getElementsByTagName("toyunda-player");for(var c=0;c<d.length;c++){var g=d[c];var f={};for(var b=0;b<g.attributes.length;b++){var a=g.attributes[b];f[a.name]=a.value}f.element=g;g._toyundaPlayer=new ToyundaPlayer(f);for(var e in g._toyundaPlayer){g[e]=g._toyundaPlayer[e]}}},false);